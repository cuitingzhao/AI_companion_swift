# AI陪伴APP - 产品需求文档

## 产品概述
AI陪伴APP是一个集八字命理、个性化陪伴、成长目标管理于一体的AI助手应用。通过多个专业化的AI智能体，为用户提供个性化的陪伴、成长指导和运势分析。

## 核心功能
1. **对话系统** - 多智能体的文字和语音交互
2. **智能体系统** - 不同场景下的专业化AI助手
3. **记忆库系统** - 用户画像和历史信息管理
4. **八字命理** - 基于八字的性格分析和运势预测
5. **目标管理** - 个人成长目标和任务追踪

# 用户流程描述

## T&C
用户打开APP，弹出Terms & Conditions，用户同意后进入APP，开启 Onboarding 流程

## Onboarding（初始化流程）

### 第一步：基础信息收集
- **负责智能体**：Onboarding智能体
- **收集信息**：昵称、生日（精确到时）、出生地点

### 第二步：八字测算与性格分析
- 前端调用后端接口，存储用户基础信息
- 后端执行八字测算，获得八字信息
- 调用性格分析AI工具，基于八字结果生成性格特点列表
- 返回结果包含：八字信息、性格特点列表

### 第三步：用户确认
- 前端展示八字结果和性格特点分析
- 用户确认或修正性格推测的准确性
- 用户反馈传回后端存储

### 第四步：精灵分配与主页面进入
- Onboarding智能体根据八字五行（金木水火土）为用户分配对应的精灵
- 向用户说明精灵的含义和作用
- 前端转场进入主页面
- 主页面聊天由**主陪伴智能体**接管，负责了解用户日常生活并帮助实现个人成长目标

## 主页面

### 聊天交互
- **交互方式**：文字、语音对话，支持发送图片
- **负责智能体**：主陪伴智能体

### 首次进入主页面流程
1. 智能体通过对话了解用户的日常生活（作息、工作、兴趣等）
2. 基于对话内容初始化记忆库，建立用户画像
3. 在充分了解用户后，引导用户设置个人成长目标

### 日常交互功能
- 智能体根据对话内容调用相关工具
- 实时更新和完善记忆库中的用户信息
- 根据用户目标进度提供个性化建议和鼓励

### 主页面模块结构
| 模块 | 功能说明 |
|------|--------|
| **聊天** | 主要交互模块，与AI进行对话 |
| **今日任务** | 查看和管理当日的成长任务 |
| **目标追踪** | 查看长期目标进度和任务分解 |
| **流年运势** | 查看基于八字的运势分析 |
| **个人信息** | 查看个人资料、八字、设置和账户管理 |

## 今日任务模块

### 核心功能
APP的双重目的：**陪伴用户** + **帮助用户完成个人成长目标**

### 任务生成流程
- 当用户无活跃目标或任务时，主陪伴智能体会询问用户是否有新的成长目标
- 根据用户回答，AI工具生成具体的目标
- AI工具将目标分解为若干个具体任务
- 所有信息存储到数据库

### 任务管理
- **提醒机制**：每日不同时间段提醒用户完成任务
- **反馈方式**：
  - 用户可在前端直接反馈任务完成情况
  - 用户也可在聊天中提及完成情况，智能体自动识别并更新数据库
- **任务状态**：
  - 已完成
  - 进行中
  - 过期（未在既定时间完成）
- **智能体感知**：每次聊天时，智能体都能获取当日任务完成情况，用于提供相关建议

## 目标追踪模块

### 功能
- 展示用户的长期成长目标列表
- 显示每个目标的完成进度（百分比或阶段）
- 展示目标下的所有子任务及其完成状态
- 支持查看目标的详细信息和历史记录

### 目标生命周期
- **创建**：用户在聊天中提出目标，AI工具生成并分解
- **进行中**：用户逐步完成任务
- **完成**：所有子任务完成后，目标标记为完成
- **存档**：完成的目标可查看但不再提醒

## 流年运势模块

### 功能
- 基于用户八字进行流年运势分析
- 按月份展示运势预测

### 分析时机
- **初次使用**：分析当前年份的整体运势描述，以及剩余各月的月度运势
- **每个新流年**：在新流年开始时进行全年分析

### 展示形式
- 年度总体运势描述
- 各月份的详细运势预测
- 重要日期和事项提示

## 个人信息与设置模块

### 可查看信息
- 用户昵称和头像
- 生日和出生地点
- 八字信息
- 分配的精灵及其含义
- 性格特点分析结果

### 可进行的操作
- 修改个人信息（昵称、头像等）
- 查看账户统计（使用天数、聊天次数等）
- 隐私和数据管理
- 退出登录
- 删除账户

## 其他功能模块

### 每日签
- **功能**：每天生成一张运势卡片
- **内容**：基于用户八字的当日运势描述、建议和祝福
- **生成方式**：由AI工具基于八字和当日日期生成
- **展示位置**：可在主页面或聊天页面顶部展示

### 当日天气
- **数据来源**：系统天气服务或第三方天气API
- **展示位置**：主页面顶部或聊天页面
- **用途**：帮助用户了解当日天气，与运势相结合

### 当日日历与日程
- **数据来源**：系统日历应用
- **功能**：展示用户的日程安排
- **集成**：与任务提醒相结合，避免冲突

---

## 系统架构与技术细节

### 智能体系统

#### 智能体类型与职责

| 智能体/工具 | 职责 | 活跃阶段 | 调用方式 |
|------|------|--------|--------|
| **Onboarding智能体** | 收集用户基础信息，引导用户完成初始化 | 首次使用 | 用户交互 |
| **主陪伴智能体** | 日常对话、了解用户、提供建议、管理任务 | 日常使用 | 用户交互 |
| **性格分析工具** | 基于八字生成性格特点分析 | Onboarding阶段 | 系统自动调用 |
| **每日签生成工具** | 生成每日运势卡片 | 每日 | 系统定时调用 |

#### 主陪伴智能体可调用的工具

##### 核心工具
| 工具名称 | 功能描述 | 使用场景 |
|---------|---------|---------|
| **运势分析工具** | 查询用户的流年、流月运势 | 用户询问运势时 |
| **目标分解工具** | 将用户目标分解为具体任务 | 用户设定新目标时 |
| **目标管理工具** | 创建、更新、删除、完成目标 | 用户管理目标时 |
| **任务管理工具** | 创建、修改、标记任务状态 | 用户管理任务时 |
| **网页访问工具** | 搜索和获取网页信息 | 用户需要查询信息时 |
| **日程管理工具** | 查看和更新系统日历 | 用户安排日程时 |
| **闹钟设置工具** | 创建和管理闹钟提醒 | 用户需要定时提醒时 |

##### iOS系统集成工具

**高优先级（必需）**
| 工具名称 | iOS权限 | 功能描述 |
|---------|---------|---------|
| **推送通知工具** | 通知权限 | 发送任务提醒、运势提示、关怀信息 |
| **照片库访问工具** | 照片库权限 | 用户分享生活照片，AI理解图片内容 |
| **位置服务工具** | 位置权限 | 提供基于位置的天气、运势建议 |
| **语音识别与合成工具** | 麦克风权限 | 支持语音对话，提升陪伴体验 |
| **提醒事项工具** | 提醒权限 | 在iOS提醒应用中创建任务备份 |

**中优先级（建议）**
| 工具名称 | iOS权限 | 功能描述 |
|---------|---------|---------|
| **健康数据访问工具** | 健康权限 | 了解用户睡眠、运动情况，提供个性化建议 |
| **屏幕使用时间工具** | 屏幕使用时间权限 | 帮助用户管理时间，提升效率 |
| **邮件/消息发送工具** | 无需额外权限 | 帮助用户发送重要信息或总结 |
| **备忘录访问工具** | 备忘录权限 | 帮助用户记录想法和灵感 |

**低优先级（可选）**
| 工具名称 | iOS权限 | 功能描述 |
|---------|---------|---------|
| **Siri快捷指令** | Siri权限 | 通过Siri快速访问功能 |
| **联系人访问工具** | 通讯录权限 | 社交功能扩展（如分享成长进度） |
| **音乐库访问工具** | 媒体库权限 | 根据心情推荐音乐 |

#### 工具调用机制
- 主陪伴智能体基于对话内容自动识别需要调用的工具
- 工具调用需要用户授权相应的iOS权限
- 所有工具调用结果需存储到数据库
- 敏感操作（如发送消息、修改日程）需要用户确认

### 记忆库系统

#### 记忆库的作用
- 存储用户的个人信息和历史交互数据
- 建立和维护用户画像
- 为智能体提供上下文信息，提升对话质量

#### 记忆库包含的内容
- **用户基础信息**：昵称、生日、出生地点、八字、性格特点
- **用户画像**：日常作息、工作情况、兴趣爱好、生活习惯
- **交互历史**：聊天记录、用户反馈、偏好信息
- **目标与任务**：活跃目标、任务列表、完成记录
- **系统生成信息**：运势分析、每日签等

#### 记忆库的更新机制
- **主动更新**：用户在聊天中提供新信息时自动更新
- **被动更新**：用户在各模块进行操作时（如完成任务）更新
- **定期分析**：定期对聊天内容进行NLP分析，提取新的用户特征

### 数据存储

#### 需要持久化的数据
- 用户账户信息
- 八字和性格分析结果
- 目标和任务数据
- 聊天记录
- 记忆库数据
- 运势分析结果

#### 数据安全
- 用户数据需加密存储
- 支持数据导出和删除
- 符合隐私保护法规

---

## 未来扩展方向
- 社交功能：用户间的互动和分享
- 高级分析：更深入的性格和运势分析
- 多语言支持
- 离线模式支持
- 第三方集成（日历、提醒等）

## Some thoughts:
1. 用户进入 app
2. app 端出声音：欢迎使用星宝，先起一个昵称吧；
3. 用户输入昵称，点击确认
4. app 端出声音：好的，XX，很高兴认识你。 接下来我需要以下信息来你计算你的生辰八字，从而更好的了解你
5. 用户输入生辰信息以及性别，点击确认
6. app 端出声音：很好，现在开始计算你的生辰八字，请稍等。分别调用计算八字和推测性格的接口，八字出来之后先返回，然后再返回性格分析
7. 生辰八字逐个出现，根据不同的八字显现方式不同。都出现之后，日主的字不断闪烁。
8. app 端出声音：好的，XX，你的生辰八字计算完成，根据你的八字，你的日主为壬水，也就是八字里不断闪烁的那个字。所以我将为你分配“水宝”作为你的守护精灵。从今以后，它将陪伴你左右 - 水宝的出场动画
9. 切换到水宝的聊天页面
10. 水宝出声音：你好，XX，我是水宝，很高兴认识你。我将通过你的八字分析你的性格，然后需要你进行反馈是否准确，可以吗？
11. 用户输入性格，点击确认
12. 把性格特点逐条显示给用户进行确认。
13. 全部完成后，水宝出声音：感谢你的反馈！我现在对你的性格已经有了一个初步的了解。我的目标不仅是陪伴，也想帮助你完成多个目标，成为你更希望的那个样子的自己。所以，你介意提供一些你的日常生活信息让我更好地了解你吗？
14. 
- 如果用户选择跳过，则直接进入当日任务页面。
- 如果没有跳过，则通过对话的方式引导用户提供相应信息。
星宝：方便给我位置权限以便我了解你现在在哪个城市吗？
弹出权限请求窗口
用户：取消的话，星宝会说“了解你的顾虑。如果你之后改变注意，可以去应用里开启这个权限给我。” 然后紧接着发送一句： 那你现在已经从学校毕业了吗？
没有取消的话，星宝会对城市做一些 comments，然后问： 那你现在已经从学校毕业了吗？（以此类推，分别询问工作情况，恋爱状况，兴趣爱好等，每获取一个答案都要做一些 comments 再进行下一个问题的询问。用户如果中途跳过，则用户信息的这部分为空，给后端的回复可以标为“未提供”，在以后的聊天过程中再补充进去。

想法：
KYC agent 负责：1. 根据 AI 返回的结果更新下一轮给 AI 的提示词； 2. 根据 AI 返回的结果存储信息到用户 DB
刚开始时，给AI的输出要求，提示词应该类似这样：
你是一个AI伙伴，名字是X宝。你的目标是通过谈话，让用户提供以下个人信息：
1. 是否为学生还是已经毕业
2. 如果已经毕业的话，工作情况是怎样的
3. 恋爱状况是怎样的
4. 有什么兴趣爱好

用户的基本信息如下：
  昵称：XX
  性别：XX
  年龄：XX
  生辰八字：XXXX
  性格概要：XXXXXXXX  
  城市：XX

我们还需要了解的个人信息如下：
1. 是否为学生： 未知
2. 工作情况： 未知
3. 恋爱状况： 未知
4. 兴趣爱好： 未知

如果用户的回复没有包含以上我们要了解的任何一项，请礼貌回复并把话题带回到以上四项中的一项。如果用户的回复里透露出不想回答某个基本信息时，请不要再追问，并在你的回复里给对应项标记为“拒绝回答”。
你的输出结果为 json，格式如下，其中 0 代表要回复给用户的的信息，1 代表是否为学生，2 代表工作情况，3 代表恋爱状况，4 代表兴趣爱好：
{
    "0": "XX",
    "1": "未知/拒绝回答/是/否",
    "2": "未知/拒绝回答/上班族/自由职业者/退休/家庭主夫（妇）/其他",
    "3": "未知/拒绝回答/单身/恋爱中/已婚/离婚/丧偶",
    "4": "未知/拒绝回答/兴趣爱好"
}

需求：Agent需要根据 AI 的返回更新提示词以及更新用户标
问题：兴趣爱好可能有多个，如何优化提示词以及 AI和 agent 的交互，来保证收集了足够的兴趣爱好呢？

15. 基础信息获取之后，询问用户最近是否有什么小目标。用户给出目标之后，agent 调用目标分解工具，将目标分解为具体任务，然后将任务添加到任务列表中。任务生成之后，出声音：太棒了，我根据你的这个目标帮你制定了一个计划，这个计划包含若干个简单的小任务。我每天晚上会把第二天的任务列表做好，所以你每天早上打开 app 时，就会有一些小“惊喜”。如果用户没有给出目标，则回复“好的，当你有任何目标时请告诉我，我会帮你制定计划的”，然后用户点击确定，进入当日任务主页。
16. 


